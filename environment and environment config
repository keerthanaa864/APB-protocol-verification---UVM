class apb_env extends uvm_env;
  `uvm_component_utils(apb_env)
  apb_agent magent;
  apb_sequencer vsqr;
  apb_sb sb;
  apb_env_config env_cfg;
  
  
  //construct phase
  function new(string name="apb_env",uvm_component parent);
    super.new(name,parent);
  endfunction
  
  
  //build phase
  function void build_phase(uvm_phase phase);
    super.build_phase(phase);
    if(!uvm_config_db#(apb_env_config)::get(this,"*","apb_env_config",env_cfg))
      `uvm_fatal("apb_env_config","cant get env handle");
      if(env_cfg.has_apb_agent)
        magent=apb_agent::type_id::create("magent",this);
    if(env_cfg.has_apb_sb)
      sb=apb_sb::type_id::create("sb",this);
    
    uvm_config_db #(apb_agent_config)::set(this,"*","apb_agent_config",env_cfg.m_cfg);
  endfunction
  
  //connect phase
  
  function void connect_phase(uvm_phase phase);
    super.connect_phase(phase);
    if(env_cfg.has_apb_agent)
      magent.mon.apb_monitor_port.connect(sb.apb_fifo.analysis_export);
  endfunction
  
  function void report();
    uvm_report_server reportserver=uvm_report_server::get_server();
    if(reportserver.get_severity_count(UVM_FATAL) == 0 &&
       reportserver.get_severity_count(UVM_ERROR) == 0) 
      `uvm_info (get_type_name(),">>>>>  TEST PASSED", UVM_DEBUG) 
      else
        `uvm_info (get_type_name(),">>>>>>> TEST FAILED", UVM_DEBUG)
        endfunction
        endclass


   class apb_env_config extends uvm_object;
  `uvm_object_utils(apb_env_config)
  
   bit has_apb_agent=1;
   bit has_apb_sb=1;
   bit has_virt_sequencer=0;
   bit data_check_on=0;
  
  apb_agent_config m_cfg;
  
  
  function new(string name="apb_env_config");
    super.new(name);
  endfunction
endclass
